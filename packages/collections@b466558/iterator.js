"use strict";function Iterator(e){if(!(this instanceof Iterator))return new Iterator(e);if(Array.isArray(e)||"string"==typeof e)return Iterator.iterate(e);if(e=Object(e),e instanceof Iterator)return e;if(e.next)this.next=function(){return e.next()};else if(e.iterate){var t=e.iterate();this.next=function(){return t.next()}}else{if("[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Can't iterate "+e);this.next=e}}module.exports=Iterator;var Object=require("./shim-object"),GenericCollection=require("./generic-collection");Iterator.prototype.forEach=GenericCollection.prototype.forEach,Iterator.prototype.map=GenericCollection.prototype.map,Iterator.prototype.filter=GenericCollection.prototype.filter,Iterator.prototype.every=GenericCollection.prototype.every,Iterator.prototype.some=GenericCollection.prototype.some,Iterator.prototype.any=GenericCollection.prototype.any,Iterator.prototype.all=GenericCollection.prototype.all,Iterator.prototype.min=GenericCollection.prototype.min,Iterator.prototype.max=GenericCollection.prototype.max,Iterator.prototype.sum=GenericCollection.prototype.sum,Iterator.prototype.average=GenericCollection.prototype.average,Iterator.prototype.flatten=GenericCollection.prototype.flatten,Iterator.prototype.zip=GenericCollection.prototype.zip,Iterator.prototype.enumerate=GenericCollection.prototype.enumerate,Iterator.prototype.sorted=GenericCollection.prototype.sorted,Iterator.prototype.group=GenericCollection.prototype.group,Iterator.prototype.reversed=GenericCollection.prototype.reversed,Iterator.prototype.toArray=GenericCollection.prototype.toArray,Iterator.prototype.toObject=GenericCollection.prototype.toObject,Iterator.prototype.iterator=GenericCollection.prototype.iterator,Iterator.prototype.__iterationObject=null,Object.defineProperty(Iterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Iterator.prototype.constructClone=function(e){var t=[];return t.addEach(e),t},Iterator.prototype.mapIterator=function(e){var t=Iterator(this),n=arguments[1],i=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new t.constructor(function(){if(t._iterationObject.done!==!0){var r=e.call(n,t.next().value,i++,t);t._iterationObject.value=r}return t._iterationObject})},Iterator.prototype.filterIterator=function(e){var t=Iterator(this),n=arguments[1],i=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new t.constructor(function(){for(var r;;){if(r=t.next(),r.done===!0)return r;if(e.call(n,r.value,i++,t))return r}})},Iterator.prototype.reduce=function(e){var t,n=Iterator(this),i=arguments[1],r=arguments[2],a=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;if(t=n.next(),t.done===!0){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(i=arguments.length>1?e.call(r,i,t.value,a,n):t.value,a++;;){if(t=n.next(),t.done===!0)return i;i=e.call(r,i,t.value,a,n),a++}},Iterator.prototype.concat=function(){return Iterator.concat(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.dropWhile=function(e){var t,n,i=Iterator(this),r=arguments[1],a=!1,s=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;for(;;){if(n=i.next(),n.done===!0)break;if(!e.call(r,n.value,s,i)){a=!0,t=n.value;break}s++}return a?i.constructor([t]).concat(i):i.constructor([])},Iterator.prototype.takeWhile=function(e){var t=Iterator(this),n=arguments[1],i=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new t.constructor(function(){if(t._iterationObject.done!==!0){var r=t.next().value;e.call(n,r,i++,t)?t._iterationObject.value=r:(t._iterationObject.done=!0,t._iterationObject.value=void 0)}return t._iterationObject})},Iterator.prototype.zipIterator=function(){return Iterator.unzip(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.enumerateIterator=function(e){return Iterator.count(e).zipIterator(this)},Iterator.iterate=function(e){var t;return t=0,new Iterator(function(){if("object"==typeof e)for(;!(t in e);){if(t>=e.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}t+=1}else t>=e.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=e[t],t+=1),this._iterationObject})},Iterator.cycle=function(e,t){var n;return 2>arguments.length&&(t=1/0),new Iterator(function(){var i,r;return n&&(r=n()),n&&r.done!==!0||(t>0?(t--,i=Iterator.iterate(e),r=(n=i.next.bind(i))()):(this._iterationObject.done=!0,r=this._iterationObject)),r})},Iterator.concat=function(e){e=Iterator(e);var t;return new Iterator(function(){var n,i;return t&&(i=t()),i&&i.done!==!0?i:(i=e.next(),i.done===!1?(n=Iterator(i.value),t=n.next.bind(n),t()):i)})},Iterator.unzip=function(e){return e=Iterator(e).map(Iterator),0===e.length?new Iterator([]):new Iterator(function(){var t,n,i=e.map(function(e){return n=e.next(),n.done===!0&&(t=!0),n.value});return t?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=i,this._iterationObject})},Iterator.zip=function(){return Iterator.unzip(Array.prototype.slice.call(arguments))},Iterator.chain=function(){return Iterator.concat(Array.prototype.slice.call(arguments))},Iterator.range=function(e,t,n){return 3>arguments.length&&(n=1),2>arguments.length&&(t=e,e=0),e=e||0,n=n||1,new Iterator(function(){e>=t&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var i=e;return e+=n,this._iterationObject.value=i,this._iterationObject})},Iterator.count=function(e,t){return Iterator.range(e,1/0,t)},Iterator.repeat=function(e,t){return new Iterator.range(t).mapIterator(function(){return e})};